<div class="destinations-container">
  <!-- Header -->
  <div class="header-section">
    <div class="header-content">
      <div class="header-left">
        <i class="fas fa-globe header-icon"></i>
        <h1 class="header-title">Gestion des Destinations</h1>
      </div>
      <div class="header-actions">
        <button routerLink="/admin/destinations/create" class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Nouvelle Destination
        </button>
        <button (click)="openSyncModal()" class="btn btn-secondary">
          <i class="fas fa-sync-alt"></i>
          Synchroniser
        </button>
        <button (click)="loadData()" class="btn btn-secondary">
          <i class="fas fa-refresh"></i>
          Actualiser
        </button>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i>
    {{ errorMessage }}
    <button (click)="clearMessages()" class="alert-close">√ó</button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    {{ successMessage }}
    <button (click)="clearMessages()" class="alert-close">√ó</button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Chargement des donn√©es...</p>
    </div>
  </div>

  <!-- üîç Recherche et Filtres MODERNES -->
  <div class="search-filters-section">
    <div class="search-box">
      <i class="fas fa-search search-icon"></i>
      <input 
        type="text" 
        [(ngModel)]="searchText" 
        (input)="applyFilters()"
        placeholder="Rechercher par pays, code ou op√©rateur..."
        class="search-input"
      />
      <button *ngIf="searchText" (click)="searchText = ''; applyFilters()" class="clear-search">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="filters-group">
      <button (click)="showFilters = !showFilters" class="btn-filter-toggle">
        <i class="fas fa-filter"></i>
        Filtres
        <span *ngIf="filterStatus !== 'all' || filterActive !== 'all'" class="filter-badge">‚óè</span>
      </button>

      <div *ngIf="showFilters" class="filters-dropdown">
        <div class="filter-section">
          <label class="filter-label">üìã Statut de publication</label>
          <div class="filter-buttons">
            <button 
              [class.active]="filterStatus === 'all'"
              (click)="filterStatus = 'all'; applyFilters()"
              class="filter-btn">
              Tous
            </button>
            <button 
              [class.active]="filterStatus === 'draft'"
              (click)="filterStatus = 'draft'; applyFilters()"
              class="filter-btn filter-draft">
              üü° Brouillon
            </button>
            <button 
              [class.active]="filterStatus === 'published'"
              (click)="filterStatus = 'published'; applyFilters()"
              class="filter-btn filter-published">
              üü¢ Publi√©
            </button>
          </div>
        </div>

        <div class="filter-section">
          <label class="filter-label">‚ö° Statut actif</label>
          <div class="filter-buttons">
            <button 
              [class.active]="filterActive === 'all'"
              (click)="filterActive = 'all'; applyFilters()"
              class="filter-btn">
              Tous
            </button>
            <button 
              [class.active]="filterActive === 'active'"
              (click)="filterActive = 'active'; applyFilters()"
              class="filter-btn filter-active">
              ‚úÖ Actif
            </button>
            <button 
              [class.active]="filterActive === 'inactive'"
              (click)="filterActive = 'inactive'; applyFilters()"
              class="filter-btn filter-inactive">
              ‚õî Inactif
            </button>
          </div>
        </div>

        <button (click)="resetFilters()" class="btn-reset-filters">
          <i class="fas fa-undo"></i>
          R√©initialiser
        </button>
      </div>
    </div>

    <div class="results-counter">
      <span class="counter-text">
        {{ filteredDestinations.length }} / {{ destinations.length }} destinations
      </span>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div *ngIf="stats" class="stats-grid">
    <div class="stat-card stat-card-hover">
      <div class="stat-icon stat-icon-blue">
        <i class="fas fa-globe"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Total Destinations</p>
        <p class="stat-value">{{ getFilteredStats().total }}</p>
        <p class="stat-sublabel">sur {{ stats.total_destinations }}</p>
      </div>
    </div>

    <div class="stat-card stat-card-hover">
      <div class="stat-icon stat-icon-yellow">
        <i class="fas fa-file-alt"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Brouillons</p>
        <p class="stat-value">{{ getFilteredStats().draft }}</p>
        <p class="stat-sublabel">non publi√©es</p>
      </div>
    </div>

    <div class="stat-card stat-card-hover">
      <div class="stat-icon stat-icon-green">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Publi√©es</p>
        <p class="stat-value">{{ getFilteredStats().published }}</p>
        <p class="stat-sublabel">sur le site</p>
      </div>
    </div>

    <div class="stat-card stat-card-hover">
      <div class="stat-icon stat-icon-purple">
        <i class="fas fa-sim-card"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">eSIMs Disponibles</p>
        <p class="stat-value">{{ stats.available_esims }}</p>
        <p class="stat-sublabel">sur {{ stats.total_esims }}</p>
      </div>
    </div>
  </div>

  <!-- Destinations Grid MODERNE -->
  <div class="destinations-grid-modern">
    <div *ngFor="let destination of filteredDestinations" class="destination-card-modern">
      <!-- Badges en haut -->
      <div class="card-badges">
        <span class="badge" [ngClass]="getPublishBadge(destination).class">
          <i class="fas" [ngClass]="getPublishBadge(destination).icon"></i>
          {{ getPublishBadge(destination).text }}
        </span>
        <span class="badge" [ngClass]="getActiveBadge(destination).class">
          {{ getActiveBadge(destination).text }}
        </span>
      </div>

      <!-- Header avec drapeau -->
      <div class="card-header-modern">
        <div class="destination-flag-large">
          <img 
            [src]="'https://flagcdn.com/w80/' + destination.country_code.toLowerCase() + '.png'"
            [alt]="destination.country_name"
            class="flag-img"
            (error)="$any($event.target).src='https://flagcdn.com/w320/' + destination.country_code.toLowerCase() + '.png'"
          />
        </div>
        <div class="destination-info-modern">
          <h3 class="destination-name-modern">{{ destination.country_name }}</h3>
          <p class="destination-code">{{ destination.country_code }}</p>
          <p class="destination-provider-modern">
            <i class="fas fa-network-wired"></i>
            {{ destination.network_provider || 'Non sp√©cifi√©' }}
          </p>
        </div>
      </div>

      <!-- Stats rapides -->
      <div class="card-stats">
        <div class="stat-item">
          <i class="fas fa-box"></i>
          <span>{{ getPackagesCount(destination) }} packages</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-sim-card"></i>
          <span>{{ getTotalAvailableEsims(destination) }} eSIMs</span>
        </div>
      </div>

      <!-- Packages (aper√ßu) -->
      <div class="packages-preview" *ngIf="destination.packages.length > 0">
        <div *ngFor="let pkg of destination.packages.slice(0, 3)" class="package-preview-item">
          <div class="package-preview-info">
            <span class="package-preview-data">{{ pkg.data_limit }}GB</span>
            <span class="package-preview-days">{{ pkg.validity_days }}j</span>
          </div>
          <div class="package-preview-stock">
            <span [ngClass]="getStockStatus(pkg).class">
              {{ pkg.available_esims }}/{{ pkg.total_esims }}
            </span>
          </div>
        </div>
        <div *ngIf="destination.packages.length > 3" class="package-more">
          +{{ destination.packages.length - 3 }} autres
        </div>
      </div>

      <!-- Actions -->
      <div class="card-actions-modern">
        <!-- Bouton PUBLIER pour brouillons -->
        <button 
          *ngIf="!destination.is_published"
          (click)="publishDestination(destination)" 
          class="btn-action btn-publish">
          <i class="fas fa-rocket"></i>
          Publier
        </button>

        <!-- Boutons classiques -->
        <button 
          (click)="viewDestinationDetails(destination)" 
          class="btn-action btn-view">
          <i class="fas fa-eye"></i>
          D√©tails
        </button>

        <!-- üîë Bouton "Retirer" SEULEMENT pour les destinations cr√©√©es par l'admin -->
        <button 
          *ngIf="destination.is_published && destination.from_admin"
          (click)="toggleDestinationVisibility(destination)" 
          class="btn-action btn-unpublish"
          title="Retirer cette destination du site">
          <i class="fas fa-eye-slash"></i>
          Retirer
        </button>
        
        <!-- üìå Message pour les destinations hardcod√©es -->
        <span 
          *ngIf="!destination.from_admin" 
          class="badge-hardcoded"
          title="Cette destination est hardcod√©e et ne peut pas √™tre retir√©e">
          <i class="fas fa-lock"></i> Toujours visible
        </span>
      </div>
    </div>

    <!-- Message si aucun r√©sultat -->
    <div *ngIf="filteredDestinations.length === 0 && !loading" class="no-results">
      <i class="fas fa-search fa-3x"></i>
      <h3>Aucune destination trouv√©e</h3>
      <p *ngIf="searchText || filterStatus !== 'all' || filterActive !== 'all'">
        Essayez d'ajuster vos filtres ou votre recherche
      </p>
      <button (click)="resetFilters()" class="btn btn-primary">
        R√©initialiser les filtres
      </button>
    </div>
  </div>

  <!-- Modal D√©tails (existant) -->
  <div *ngIf="showDetailsModal" class="modal-overlay" (click)="closeDetailsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedDestination?.country_name }}</h2>
        <button (click)="closeDetailsModal()" class="modal-close">√ó</button>
      </div>
      <div class="modal-body">
        <div *ngFor="let pkg of selectedDestination?.packages" class="package-details">
          <h4>{{ pkg.plan_name }}</h4>
          <p>{{ pkg.data_limit }}GB - {{ pkg.validity_days }} jours</p>
          <p>Prix: {{ formatPrice(pkg.price) }}</p>
          <p>eSIMs: {{ pkg.available_esims }}/{{ pkg.total_esims }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Sync (existant) -->
  <div *ngIf="showSyncModal" class="modal-overlay" (click)="closeSyncModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Synchroniser les destinations</h2>
        <button (click)="closeSyncModal()" class="modal-close">√ó</button>
      </div>
      <div class="modal-body">
        <label>Nombre limite de SIMs √† synchroniser:</label>
        <input type="number" [(ngModel)]="syncLimit" min="1" max="1000" />
        <button (click)="syncDestinations()" [disabled]="syncLoading" class="btn btn-primary">
          <span *ngIf="!syncLoading">Lancer la synchronisation</span>
          <span *ngIf="syncLoading">Synchronisation en cours...</span>
        </button>
      </div>
    </div>
  </div>
</div>
